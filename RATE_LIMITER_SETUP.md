# ๐ง Rate Limiter - ุฏููู ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

## ๐ฏ ูุง ุชู ุญูู

ุชู ุฅุตูุงุญ ูุดููุฉ ุงุชุตุงู Redis ูุงูุชู ูุงูุช ุชุณุจุจ ุงูุฃุฎุทุงุก ุงูุชุงููุฉ:
```
Error: connect ECONNREFUSED 127.0.0.1:6379
```

---

## ๐๏ธ ุงูุญู ุงูููุถูุน (Smart Fallback Pattern)

ุชู ุชุทุจูู ููุท **Fallback ุงูุฐูู** ุงูุฐู ูุนูู ูู ุญุงูุชูู:

### โ ุงูุญุงูุฉ 1: Redis ูุชุงุญ
- ูุณุชุฎุฏู Redis ูุชุฎุฒูู ุจูุงูุงุช Rate Limiting
- ุฃุฏุงุก ุนุงูู ุฌุฏุงู ูููุฒุน
- ููุงุณุจ ููุฅูุชุงุฌ ูุงูุชุทุจููุงุช ุนูู ูุทุงู ูุงุณุน

### โ ุงูุญุงูุฉ 2: Redis ุบูุฑ ูุชุงุญ
- ููุชูู ุชููุงุฆูุงู ุฅูู `RateLimiterMemory` (ุงูุฐุงูุฑุฉ)
- ูุนูู ุจููุงุกุฉ ููุจููุฉ
- ูุซุงูู ููุชุทููุฑ ูุงูุงุฎุชุจุงุฑ

---

## ๐ ุงูุฎุทูุงุช ุงูููุฌุฒุฉ

### 1๏ธโฃ ุชุตุญูุญ ููู `rateLimiter.js`
โ ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุงุชุตุงู  
โ ุชุทุจูู ููุท Fallback ุงูุฐูู  
โ ุฅุถุงูุฉ ุชุณุฌูู ุดุงูู (Logging)  
โ ุฏุนู ุฅุบูุงู ุงูุงุชุตุงู ุงูุขูู  

### 2๏ธโฃ ุชุญุฏูุซ ููู `server.js`
โ ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฅุดุงุฑุงุช ุงูุฅููุงู (SIGTERM/SIGINT)  
โ ุฅุบูุงู ุขูู ูู Redis ุนูุฏ ุฅููุงู ุงูุชุทุจูู  

### 3๏ธโฃ ุชุญุฏูุซ ููู `.env`
โ ุฅุถุงูุฉ ูุชุบูุฑุงุช Redis (ุงุฎุชูุงุฑูุฉ)  
โ ุชุตุญูุญ ุงุณู ุงููุชุบูุฑ `PORT` (ูุงู `port`)  

---

## ๐ ุงูุฎูุงุฑุงุช ุงููุชุงุญุฉ

### ุงูุฎูุงุฑ 1: ุงุณุชุฎุฏุงู Memory Limiter (ุงูุงูุชุฑุงุถู ุงูุขู)
**ูู ุงููุถุน ุงูุญุงููุ ุงูุชุทุจูู ุณูุนูู ุจุฏูู Redis!**

```bash
npm start
```

**ุงููุฎุฑุฌุงุช ุงููุชููุนุฉ:**
```
โ๏ธ ูู ูุชููู ูู ุงูุงุชุตุงู ุจู Redis: ...
๐ ุณูุชู ุงุณุชุฎุฏุงู Rate Limiter ูู ุงูุฐุงูุฑุฉ (Memory) ุจุฏูุงู ููู
โ Rate Limiter (Memory) ุฌุงูุฒ
```

**ุงูููุฒุงุช:**
- โ ูุง ุชุซุจูุช ุฅุถุงูู ูุทููุจ
- โ ูุนูู ุนูู ุงูููุฑ
- โ ููุงุณุจ ููุชุทููุฑ ูุงูุงุฎุชุจุงุฑ
- โ๏ธ ุงูุจูุงูุงุช ุชูููุฏ ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
- โ๏ธ ูุง ูุนูู ูู ุจูุฆุฉ ูุนุชูุฏุฉ ุนูู ุนุฏุฉ ุนูููุงุช/ุฎูุงุฏู

---

### ุงูุฎูุงุฑ 2: ุชุซุจูุช ูุชุดุบูู Redis (ุงูุฅูุชุงุฌ)

#### ุฃ) ุนูู Windows - ุงุณุชุฎุฏุงู Windows Subsystem for Linux (WSL)

```powershell
# 1. ุชุดุบูู WSL
wsl

# 2. ุชุซุจูุช Redis
sudo apt-get install redis-server

# 3. ุชุดุบูู Redis
redis-server

# 4. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู (ูู ูุงูุฐุฉ ุฃุฎุฑู)
redis-cli ping
# ูุฌุจ ุฃู ูุทุจุน: PONG
```

#### ุจ) ุนูู Windows - ุงุณุชุฎุฏุงู Docker

```powershell
# 1. ุชุซุจูุช Docker Desktop (ุฅุฐุง ูู ููู ูุซุจุชุงู)

# 2. ุชุดุบูู Redis ูู Docker
docker run --name redis-container -d -p 6379:6379 redis:latest

# 3. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
docker exec redis-container redis-cli ping
# ูุฌุจ ุฃู ูุทุจุน: PONG
```

#### ุฌ) ุนูู Windows - ุงุณุชุฎุฏุงู ุจุฑูุงูุฌ Redis ูุฏุฑุฌ

```powershell
# ุชุญููู ูู: https://github.com/microsoftarchive/redis/releases

# ุจุนุฏ ุงูุชุซุจูุชุ ุชุดุบูู:
redis-server.exe
```

#### ุฏ) ุนูู Linux/Mac

```bash
# macOS
brew install redis
redis-server

# Linux (Ubuntu/Debian)
sudo apt-get install redis-server
sudo systemctl start redis-server
```

---

## โจ ุจุนุฏ ุชุดุบูู Redis

```bash
npm start
```

**ุงููุฎุฑุฌุงุช ุงููุชููุนุฉ:**
```
โ Redis ูุชุตู ุจูุฌุงุญ
๐ Rate Limiter (Redis) ุฌุงูุฒ
๐ ุงูุณูุฑูุฑ ูุนูู ุนูู http://localhost:3000
```

---

## ๐ง ูุชุบูุฑุงุช ุงูุจูุฆุฉ (`.env`)

```env
# ุฅุนุฏุงุฏุงุช ุงูุฎุงุฏู
PORT=3000
NODE_ENV=development
LOG_LEVEL=info

# ูุงุนุฏุฉ ุงูุจูุงูุงุช
MONGODB_URI=mongodb://localhost:27017/e-commerce-backend
JWT_SECRET=your_jwt_secret_key

# Redis (ุงุฎุชูุงุฑู - ููุฅูุชุงุฌ ููุท)
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
```

---

## ๐ ููููุฉ ุนูู Rate Limiter

### ุงูุชุญุฏูุฏ ุงูุญุงูู (100 ุทูุจ / ุณุงุนุฉ)

```javascript
points: 100,             // ุงูุญุฏ ุงูุฃูุตู ููุทูุจุงุช
duration: 60 * 60,       // ูู ุณุงุนุฉ (3600 ุซุงููุฉ)
blockDuration: 60 * 15,  // ุญุธุฑ 15 ุฏูููุฉ ุจุนุฏ ุงูุชุฌุงูุฒ
```

### ูุซุงู ุนูู ุงูุงุณุชุฌุงุจุฉ ุนูุฏ ุชุฌุงูุฒ ุงูุญุฏ

```json
{
  "status": "error",
  "message": "ููุฏ ุชุฌุงูุฒุช ุงูุญุฏ ุงููุณููุญ ุจู ูู ุงูุทูุจุงุช",
  "retryAfter": 600,
  "timestamp": "2026-02-03T10:30:00.000Z"
}
```

---

## ๐งช ุงุฎุชุจุงุฑ Rate Limiter

### ุทุฑููุฉ 1: ุงุณุชุฎุฏุงู cURL

```bash
# ุงุฎุชุจุฑ 150 ุทูุจ ุณุฑูุน
for i in {1..150}; do
  curl http://localhost:3000/api/products
  echo "Request $i"
done
```

### ุทุฑููุฉ 2: ุงุณุชุฎุฏุงู Python

```python
import requests
import time

url = "http://localhost:3000/api/products"

for i in range(150):
    response = requests.get(url)
    if response.status_code == 429:
        print(f"Request {i}: Rate Limited! Retry After: {response.headers.get('Retry-After')}s")
        break
    else:
        print(f"Request {i}: OK ({response.status_code})")
    time.sleep(0.01)
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูุฒุงู ูุธูุฑ ุฎุทุฃ Redis

**ุงูุญู:**
```javascript
// ุชุญูู ูู ุงูุณุฌูุงุช ูู .env
LOG_LEVEL=debug

// ุซู ุดุบู ุงูุชุทุจูู ูุฑุงูุจ ุงูุฑุณุงุฆู
npm start
```

---

### ุงููุดููุฉ: Rate Limiter ูุง ูุนูู

**ุชุญูู:**
```bash
# ูู ุงูุชุทุจูู ูุทุจุน:
# โ Rate Limiter (Redis) ุฌุงูุฒ
# ุฃู
# โ Rate Limiter (Memory) ุฌุงูุฒ
```

---

## ๐ ุชุญุณููุงุช ูุณุชูุจููุฉ

- [ ] ุงุณุชุฎุฏุงู Redis Cluster ููุชูุณุน ุงูุฃููู
- [ ] ุฏุนู ูุญุฏุงุช ุชุญุฏูุฏ ูุนุฏู ูุฎุตุตุฉ ูููุงุท ููุงูุฉ ูุฎุชููุฉ
- [ ] ุญูุธ ุณุฌู ุชุฌุงูุฒ ุงูุญุฏ ููุชุญููู
- [ ] ูุงุฌูุฉ ูุณุคูู ูุฅุฏุงุฑุฉ ุงููููุฏ
- [ ] ุงุฎุชุจุงุฑุงุช ูุญุฏุฉ ุดุงููุฉ

---

## ๐ ุงููุฑุงุฌุน

- [rate-limiter-flexible Documentation](https://github.com/animir/node-rate-limiter-flexible)
- [ioredis Documentation](https://github.com/luin/ioredis)
- [Redis Official](https://redis.io/)

---

**ุขุฎุฑ ุชุญุฏูุซ**: 3 ูุจุฑุงูุฑ 2026
